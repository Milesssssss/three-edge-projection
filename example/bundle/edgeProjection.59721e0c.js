let e,t,r,o,i,n,s,a,l,d,c,u;function p(e,t,r,o){Object.defineProperty(e,t,{get:r,set:o,enumerable:!0,configurable:!0})}var f="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},h={},g={},w=f.parcelRequire6c98;null==w&&((w=function(e){if(e in h)return h[e].exports;if(e in g){var t=g[e];delete g[e];var r={id:e,exports:{}};return h[e]=r,t.call(r.exports,r,r.exports),r.exports}var o=Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,t){g[e]=t},f.parcelRequire6c98=w),w.register("27Lyk",function(e,t){p(e.exports,"register",()=>r,e=>r=e),p(e.exports,"resolve",()=>o,e=>o=e);var r,o,i={};r=function(e){for(var t=Object.keys(e),r=0;r<t.length;r++)i[t[r]]=e[t[r]]},o=function(e){var t=i[e];if(null==t)throw Error("Could not resolve bundle with id "+e);return t}}),w("27Lyk").register(JSON.parse('{"gEVFf":"edgeProjection.59721e0c.js","8zbCD":"projectionAsync.worker.28971622.js","bGZIs":"projectionAsync.worker.9c6d2a59.js","9UJIV":"silhouetteProjection.577d2f3c.js","fEfc5":"planarIntersection.ac7f7708.js"}'));var y=w("ilwiq"),m=w("jiuw3"),b=w("5Rd1x"),k=w("7lx9d"),y=w("ilwiq");const L=new WeakMap;class P extends y.Loader{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,r,o){let i=new y.FileLoader(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,e=>{this.parse(e,t,o)},r,o)}parse(e,t,r){this.decodeDracoFile(e,t,null,null,y.SRGBColorSpace).catch(r)}decodeDracoFile(e,t,r,o,i=y.LinearSRGBColorSpace){let n={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:o||this.defaultAttributeTypes,useUniqueIDs:!!r,vertexColorSpace:i};return this.decodeGeometry(e,n).then(t)}decodeGeometry(e,t){let r;let o=JSON.stringify(t);if(L.has(e)){let t=L.get(e);if(t.key===o)return t.promise;if(0===e.byteLength)throw Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i=this.workerNextTaskID++,n=e.byteLength,s=this._getWorker(i,n).then(o=>(r=o,new Promise((o,n)=>{r._callbacks[i]={resolve:o,reject:n},r.postMessage({type:"decode",id:i,taskConfig:t,buffer:e},[e])}))).then(e=>this._createGeometry(e.geometry));return s.catch(()=>!0).then(()=>{r&&i&&this._releaseTask(r,i)}),L.set(e,{key:o,promise:s}),s}_createGeometry(e){let t=new y.BufferGeometry;e.index&&t.setIndex(new y.BufferAttribute(e.index.array,1));for(let r=0;r<e.attributes.length;r++){let o=e.attributes[r],i=o.name,n=o.array,s=o.itemSize,a=new y.BufferAttribute(n,s);"color"===i&&(this._assignVertexColorSpace(a,o.vertexColorSpace),a.normalized=n instanceof Float32Array==!1),t.setAttribute(i,a)}return t}_assignVertexColorSpace(e,t){if(t!==y.SRGBColorSpace)return;let r=new y.Color;for(let t=0,o=e.count;t<o;t++)r.fromBufferAttribute(e,t).convertSRGBToLinear(),e.setXYZ(t,r.r,r.g,r.b)}_loadLibrary(e,t){let r=new y.FileLoader(this.manager);return r.setPath(this.decoderPath),r.setResponseType(t),r.setWithCredentials(this.withCredentials),new Promise((t,o)=>{r.load(e,t,void 0,o)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(t=>{let r=t[0];e||(this.decoderConfig.wasmBinary=t[1]);let o=x.toString(),i=["/* draco decoder */",r,"","/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([i]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){let r=t.data;switch(r.type){case"decode":e._callbacks[r.id].resolve(r);break;case"error":e._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort(function(e,t){return e._taskLoad>t._taskLoad?-1:1});let r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=t,r._taskLoad+=t,r})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}function x(){let e,t;onmessage=function(r){let o=r.data;switch(o.type){case"init":e=o.decoderConfig,t=new Promise(function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)});break;case"decode":let i=o.buffer,n=o.taskConfig;t.then(e=>{let t=e.draco,r=new t.Decoder;try{let e=function(e,t,r,o){let i,n;let s=o.attributeIDs,a=o.attributeTypes,l=t.GetEncodedGeometryType(r);if(l===e.TRIANGULAR_MESH)i=new e.Mesh,n=t.DecodeArrayToMesh(r,r.byteLength,i);else if(l===e.POINT_CLOUD)i=new e.PointCloud,n=t.DecodeArrayToPointCloud(r,r.byteLength,i);else throw Error("THREE.DRACOLoader: Unexpected geometry type.");if(!n.ok()||0===i.ptr)throw Error("THREE.DRACOLoader: Decoding failed: "+n.error_msg());let d={index:null,attributes:[]};for(let r in s){let n,l;let c=self[a[r]];if(o.useUniqueIDs)l=s[r],n=t.GetAttributeByUniqueId(i,l);else{if(-1===(l=t.GetAttributeId(i,e[s[r]])))continue;n=t.GetAttribute(i,l)}let u=function(e,t,r,o,i,n){let s=n.num_components(),a=r.num_points(),l=a*s,d=l*i.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,i),u=e._malloc(d);t.GetAttributeDataArrayForAllPoints(r,n,c,d,u);let p=new i(e.HEAPF32.buffer,u,l).slice();return e._free(u),{name:o,array:p,itemSize:s}}(e,t,i,r,c,n);"color"===r&&(u.vertexColorSpace=o.vertexColorSpace),d.attributes.push(u)}return l===e.TRIANGULAR_MESH&&(d.index=function(e,t,r){let o=r.num_faces(),i=3*o,n=4*i,s=e._malloc(n);t.GetTrianglesUInt32Array(r,n,s);let a=new Uint32Array(e.HEAPF32.buffer,s,i).slice();return e._free(s),{array:a,itemSize:1}}(e,t,i)),e.destroy(i),d}(t,r,new Int8Array(i),n),s=e.attributes.map(e=>e.array.buffer);e.index&&s.push(e.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:e},s)}catch(e){console.error(e),self.postMessage({type:"error",id:o.id,error:e.message})}finally{t.destroy(r)}})}}}var A=w("7ePFa"),_=w("kp7Te"),T=w("4CEV9"),y=w("ilwiq");const E="ProjectionGeneratorWorker";var C={},D={};D=function(e,t,r){if(t===self.location.origin)return e;var o=r?"import "+JSON.stringify(e)+";":"importScripts("+JSON.stringify(e)+");";return URL.createObjectURL(new Blob([o],{type:"application/javascript"}))};let v=new URL(w("27Lyk").resolve("8zbCD"),import.meta.url);C=D(v.toString(),v.origin,!0);class R{constructor(){this.running=!1,this.worker=new Worker(C),this.worker.onerror=e=>{if(e.message)throw Error(`${E}: Could not create Web Worker with error "${e.message}"`);throw Error(`${E}: Could not create Web Worker.`)}}generate(e,t={}){if(this.running)throw Error(`${E}: Already running job.`);if(null===this.worker)throw Error(`${E}: Worker has been disposed.`);let{worker:r}=this;return this.running=!0,new Promise((o,i)=>{r.onerror=e=>{i(Error(`${E}: ${e.message}`)),this.running=!1},r.onmessage=e=>{this.running=!1;let{data:n}=e;if(n.error)i(Error(n.error)),r.onmessage=null;else if(n.result){let e=new y.BufferGeometry;e.setAttribute("position",new y.BufferAttribute(n.result,3,!1)),o(e),r.onmessage=null}else t.onProgress&&t.onProgress(n.progress)};let n=e.index?e.index.array.slice():null,s=e.attributes.position.array.slice(),a=[s.buffer];n&&a.push(n.buffer),r.postMessage({index:n,position:s,options:{...t,onProgress:null,includedProgressCallback:!!t.onProgress}},a)})}dispose(){this.worker.terminate(),this.worker=null}}var j=w("fNPnQ");(0,y.Object3D).DEFAULT_UP.set(0,0,1);const S={displayModel:"color",displayEdges:!1,displayProjection:!0,sortEdges:!0,includeIntersectionEdges:!1,useWorker:!0,projectionDirection:"top",rotate:()=>{a.quaternion.random(),a.position.set(0,0,0),a.updateMatrixWorld(!0);let e=new y.Box3;e.setFromObject(n,!0),e.getCenter(a.position).multiplyScalar(-1),a.position.y=Math.max(0,-e.min.y)+1},regenerate:()=>{I=O()}};let I=null;function*O(e=30){c.innerText="processing: --";let t=window.performance.now(),r=[];n.updateWorldMatrix(!0,!0),n.traverse(e=>{if(e.geometry){let t=e.geometry.clone();if(t.applyMatrix4(e.matrixWorld),t.morphTargetsRelative=!1,t.morphAttributes)for(let e in t.morphAttributes)delete t.morphAttributes[e];for(let e in t.attributes)"position"!==e&&t.deleteAttribute(e);r.push(t)}});let o=(0,A.mergeGeometries)(r,!1),i=window.performance.now()-t;yield,S.includeIntersectionEdges&&(c.innerText="processing: finding edge intersections...",s.geometry.dispose(),s.geometry=new y.BufferGeometry),t=window.performance.now();let a=null;if(S.useWorker)for(console.log(S.projectionDirection),u.generate(o,{sortEdges:S.sortEdges,projectionDirection:S.projectionDirection,includeIntersectionEdges:S.includeIntersectionEdges,iterationTime:e,angleThreshold:3,onProgress:e=>{c.innerText=`processing: ${parseFloat((100*e).toFixed(2))}%`}}).then(e=>{a=e});null===a;)yield;else{let t=new T.ProjectionGenerator;t.projectionDirection=S.projectionDirection,t.sortEdges=S.sortEdges,t.iterationTime=e,t.angleThreshold=3,t.includeIntersectionEdges=S.includeIntersectionEdges;let r=t.generate(o,{onProgress:(e,t)=>{c.innerText=`processing: ${parseFloat((100*e).toFixed(2))}%`,S.displayProjection&&(s.geometry.dispose(),s.geometry=t.getLineGeometry())}}),i=r.next();for(;!i.done;)i=r.next(),yield;a=i.value}let l=window.performance.now()-t;s.geometry.dispose(),s.geometry=a,c.innerText=`merge geometry  : ${i.toFixed(2)}ms
edge trimming   : ${l.toFixed(2)}ms`}!async function(){c=document.getElementById("output"),(e=new y.WebGLRenderer({antialias:!0})).setPixelRatio(window.devicePixelRatio),e.setSize(window.innerWidth,window.innerHeight),e.setClearColor(15658734,1),document.body.appendChild(e.domElement),r=new y.Scene;let p=new y.DirectionalLight(16777215,3.5);p.position.set(1,2,3),r.add(p);let f=new y.AmbientLight(11583173,.5);r.add(f),a=new y.Group,r.add(a);let h=await new k.GLTFLoader;h.setMeshoptDecoder(_.MeshoptDecoder);let g=new P;g.setDecoderPath("https://www.gstatic.com/draco/v1/decoders/"),h.setDRACOLoader(g);let w=await h.loadAsync("http://127.0.0.1:8080/SFL-CPD20-Y.glb");n=w.scene;let L=new y.MeshStandardMaterial({polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1});(l=n.clone()).traverse(e=>{e.material&&(e.material=L)});let x=new y.MeshBasicMaterial({polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1});(d=n.clone()).traverse(e=>{e.material&&(e.material=x)}),a.updateMatrixWorld(!0);let A=new y.Box3;A.setFromObject(n,!0),A.getCenter(a.position),a.position.y=Math.max(0,-A.min.y)+Math.abs(A.max.y),a.add(n,l),a.position.z=0,console.log(a.position),i=new y.Group,n.traverse(e=>{if(e.geometry){let t=(0,j.generateEdges)(e.geometry,void 0,3),r=t.flatMap(e=>[e.start,e.end]),o=new y.BufferGeometry;o.setFromPoints(r);let n=new y.LineSegments(o,new y.LineBasicMaterial({color:0}));n.position.copy(e.position),n.quaternion.copy(e.quaternion),n.scale.copy(e.scale),i.add(n)}}),a.add(i),s=new y.LineSegments(new y.BufferGeometry,new y.LineBasicMaterial({color:0})),r.add(s),(t=new y.PerspectiveCamera(39.5,window.innerWidth/window.innerHeight,.01,500)).position.setScalar(3.5),t.updateProjectionMatrix(),t.lookAt(0,0,0),new b.OrbitControls(t,e.domElement),(o=new m.GUI).add(S,"displayModel",["none","color","shaded white"]),o.add(S,"displayEdges"),o.add(S,"projectionDirection",["top","front","left","back","right","bottom"]),o.add(S,"displayProjection"),o.add(S,"sortEdges"),o.add(S,"includeIntersectionEdges"),o.add(S,"useWorker"),o.add(S,"rotate"),o.add(S,"regenerate"),u=new R,I=O(),function o(){if(requestAnimationFrame(o),I){let e=I.next();e.done&&(I=null)}n.visible="color"===S.displayModel,l.visible="shaded white"===S.displayModel,d.visible="white"===S.displayModel,i.visible=S.displayEdges,s.visible=S.displayProjection,e.render(r,t)}(),window.addEventListener("resize",function(){t.aspect=window.innerWidth/window.innerHeight,t.updateProjectionMatrix(),e.setSize(window.innerWidth,window.innerHeight)},!1)}();
//# sourceMappingURL=edgeProjection.59721e0c.js.map
